{% extends "core.html" %}
{% include "utils.html" %}
{% from "components/summary/_macro.njk" import onsSummary %}
{% from "components/button/_macro.njk" import onsButton %}
{% from "components/breadcrumbs/_macro.njk" import onsBreadcrumbs %}
{% set project_details = 'Programme Name: <p style="font-weight:400">' + 
    project.details[0].programme_name + '</p>' +
    'Programme Short Name: <p style="font-weight:400">' +
        project.details[0].programme_short_name + '</p>' +
    'Project Name: <p style="font-weight:400">' +
        project.details[0].name + '</p>' +
    'Short Name: <p style="font-weight:400">' +
        project.details[0].short_name + '</p>' +
    'Documentation Link: <p style="font-weight:400">' +
        project.details[0].documentation_link[0] + '</p>' +
    'Project Description: <p style="font-weight:400">' +
        project.details[0].project_description + '</p>' +
    'Stage: <p style="font-weight:400">' + project.stage %}
{% block main %}

{% with messages = get_flashed_messages() %}
{% if messages %}
  <ul class="flashes">
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}
{% endwith %}

  {{
    onsBreadcrumbs({
        "ariaLabel": 'Breadcrumbs',
        "itemsList": [
            {
                "url": '/dashboard',
                "text": 'Back'
            },
        ],
    }) }}
    {% if edit %}
        {{ onsButton({
          "text": "Edit",
          "url": url_for('edit_project', project_name=project.details[0].name),
          "attributes": {
              "style": "float: right; margin-right: 5em;"
          }
      }) }}
    {% endif %}
    {% set langs = [] %}
    <div style="margin-top: 1em;">
        {{ onsSummary({
          "summaries": [
              {
                  "groups": [
                      {
                          "placeholderText": 'test',
                          "id": "summary",
                          "groupTitle": "Summary",
                          "rows": [
                              {
                                  "id": "technical_contact_row",
                                  "rowTitle": "Technical Contact",
                                  "rowItems": [
                                      {
                                          "id": "technical-contact",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ],
                                      }
                                  ]
                              },
                              {
                                  "id": "delivery-manager-row",
                                  "rowTitle": "Delivery Manager Contact",
                                  "rowItems": [
                                      {
                                          "id": "delivery-manager",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              },
                                          ],
                                      }
                                  ]
                              },
                              {
                                  "rowTitle": "Project",
                                  "id": "project-details-row",
                                  "rowItems": [
                                      {
                                          "id": "project-details",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ],
                                      }
                                  ]
                              },
                              {
                                  "id": "development-row",
                                  "rowTitle": "Developed",
                                  "rowItems": [
                                      {
                                          "id": "developed",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ],
                                      }
                                  ]
                              },
                              {
                                  "id": "stage-row",
                                  "rowTitle": "Stage",
                                  "rowItems": [
                                      {
                                          "id": "stage",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ],
                                      }
                                  ]
                              },
                              {
                                  "id": "source-control-row",
                                  "rowTitle": "Source Control",
                                  "rowItems": [
                                      {
                                          "id": "source-control",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ],
                                      }
                                  ]
                              },
                              {
                                  "id": "hosting-row",
                                  "rowTitle": "Hosting",
                                  "rowItems": [
                                      {
                                          "id": "hosting",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ],
                                      }
                                  ]
                              },
                              {
                                  "id": "database-row",
                                  "rowTitle": "Database",
                                  "rowItems": [
                                      {
                                          "id": "database",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              },
                                          ]
                                      }
                                  ]
                              },
                            {
                                  "id": "frameworks-row",
                                  "rowTitle": "Frameworks",
                                  "rowItems": [
                                      {
                                          "id": "frameworks",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ]
                                      }
                                  ]
                              },
                          {
                                  "id": "languages-row",
                                  "rowTitle": "Languages",
                                  "rowItems": [
                                      {
                                          "id": "languages",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ]
                                      }
                                  ]
                              },
                              {
                                  "id": "cicd-row",
                                  "rowTitle": "CI/CD",
                                  "rowItems": [
                                      {
                                          "id": "cicd",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ]
                                      }
                                  ]
                              },
                        {
                                  "id": "infrastructure-row",
                                  "rowTitle": "Infrastructure",
                                  "rowItems": [
                                      {
                                          "id": "infrastructure",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ]
                                      }
                                  ]
                              },
                              {
                                  "id": "code-editors-row",
                                  "rowTitle": "Code Editors",
                                  "rowItems": [
                                      {
                                          "id": "code_editors",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ]
                                      }
                                  ]
                              },
                              {
                                  "id": "user-interface-row",
                                  "rowTitle": "User Interface",
                                  "rowItems": [
                                      {
                                          "id": "user_interface",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ]
                                      }
                                  ]
                              },
                              {
                                  "id": "diagrams-row",
                                  "rowTitle": "Diagrams",
                                  "rowItems": [
                                      {
                                          "id": "diagrams",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ]
                                      }
                                  ]
                              },
                              {
                                  "id": "project-tracking-row",
                                  "rowTitle": "Project Tracking",
                                  "rowItems": [
                                      {
                                          "id": "project_tracking",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ]
                                      }
                                  ]
                              },
                              {
                                  "id": "documentation-row",
                                  "rowTitle": "Documentation",
                                  "rowItems": [
                                      {
                                          "id": "documentation",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ]
                                      }
                                  ]
                              },
                              {
                                  "id": "communication-row",
                                  "rowTitle": "Communication",
                                  "rowItems": [
                                      {
                                          "id": "communication",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ]
                                      }
                                  ]
                              },
                              {
                                  "id": "collaboration-row",
                                  "rowTitle": "Collaboration",
                                  "rowItems": [
                                      {
                                          "id": "collaboration",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ]
                                      }
                                  ]
                              },
                              {
                                  "id": "incident-management-row",
                                  "rowTitle": "Incident Management",
                                  "rowItems": [
                                      {
                                          "id": "incident_management",
                                          "valueList": [
                                              {
                                                  "text": ""
                                              }
                                          ]
                                      }
                                  ]
                              },

                          ]
                      }
                  ]
              }
          ]
      }) }}
    </div>
    <br/>
{% endblock %}
{% block scripts %}
<script>
    const projects = {{ project | tojson | safe }};
    
    function formatList(items) {
        if (!items || items.length === 0) return 'N/A';
        return items.join(', ');
    }

    function loadData() {
        try {
        // Technical Contact
        document.getElementById('technical-contact').querySelector('dd').querySelector('span').textContent = 
                `${projects.user[0].email} (${projects.user[0].grade})`;
        } catch (e) {
            // No error
        }
        try {
            // Delivery Manager
            document.getElementById('delivery-manager').querySelector('dd').querySelector('span').textContent = 
                `${projects.user[1].email} (${projects.user[1].grade})`;
        } catch (e) {
            // No error
        }

        let projectDetails = '';
        if (projects.details[0].programme_name) {
            projectDetails += `Programme Name: <p style="font-weight:400">${projects.details[0].programme_name}</p>`
        }
        if (projects.details[0].programme_short_name) {
            projectDetails += `Programme Short Name: <p style="font-weight:400">${projects.details[0].programme_short_name}</p>`
        }
        if (projects.details[0].name) {
            projectDetails += `Project Name: <p style="font-weight:400">${projects.details[0].name}</p>`
        }
        if (projects.details[0].short_name) {
            projectDetails += `Short Name: <p style="font-weight:400">${projects.details[0].short_name}</p>`
        }
        if (projects.details[0].documentation_link !== '') {
            projectDetails += `Documentation Link: <p style="font-weight:400">${projects.details[0].documentation_link}</p>`
        }
        if (projects.details[0].project_description) {
            projectDetails += `Project Description: <p style="font-weight:400">${projects.details[0].project_description}</p>`
        }
        
        // Project Details
        document.getElementById('project-details').querySelector('dd').querySelector('span').innerHTML = 
            projectDetails;

        // Developed
        if (projects.developed[0] == 'In House') {
            document.getElementById('developed').querySelector('dd').querySelector('span').textContent = 
                `${projects.developed[0]}`;
        } else if (projects.developed[0] != 'In House' && projects.developed[1][0] != '') {
            document.getElementById('developed').querySelector('dd').querySelector('span').innerHTML = 
                `Developed: <p style="font-weight:400">${projects.developed[0]}</p>Company:<p style="font-weight:400">${projects.developed[1]}</p>`;
        } else {
            document.getElementById('developed').querySelector('dd').querySelector('span').textContent = 
                'N/A';
        }
        
        // Source Control
        if (projects.source_control[0].type) {
            document.getElementById('source-control').querySelector('dd').querySelector('span').innerHTML = 
                `${projects.source_control[0].type}<br>` +
                `${projects.source_control[0].links[0].description}: ${projects.source_control[0].links[0].url}`;
        } else {
            document.getElementById('source-control').querySelector('dd').querySelector('span').textContent = 
                'N/A';
        }

        // Stage
        document.getElementById('stage').querySelector('dd').querySelector('span').textContent = 
            projects.stage || 'N/A';

        // Hosting
        document.getElementById('hosting').querySelector('dd').querySelector('span').textContent = 
            `${projects.architecture.hosting.type[0] ? projects.architecture.hosting.type[0] : 'N/A'}`;

        // Database
        document.getElementById('database').querySelector('dd').querySelector('span').textContent = 
            formatList(projects.architecture.database.others);

        // Frameworks
        document.getElementById('frameworks').querySelector('dd').querySelector('span').textContent = 
            formatList(projects.architecture.frameworks.others);

        // Languages
        const mainLangs = projects.architecture.languages.main.join(', ');
        const otherLangs = projects.architecture.languages.others.join(', ');
        document.getElementById('languages').querySelector('dd').querySelector('span').textContent = 
            `${mainLangs}${otherLangs ? ', ' + otherLangs : 'N/A'}`;

        // CI/CD
        document.getElementById('cicd').querySelector('dd').querySelector('span').textContent = 
            formatList(projects.architecture.cicd.others);

        // Infrastructure
        document.getElementById('infrastructure').querySelector('dd').querySelector('span').textContent = 
            formatList(projects.architecture.infrastructure.others);

        // Code Editors
        document.getElementById('code_editors').querySelector('dd').querySelector('span').textContent = 
            formatList(projects.supporting_tools.code_editors.others);

        // User Interface
        document.getElementById('user_interface').querySelector('dd').querySelector('span').textContent = 
            formatList(projects.supporting_tools.user_interface.others);

        // Diagrams
        document.getElementById('diagrams').querySelector('dd').querySelector('span').textContent = 
            formatList(projects.supporting_tools.diagrams.others);

        // Project Tracking
        document.getElementById('project_tracking').querySelector('dd').querySelector('span').textContent = 
            projects.supporting_tools.project_tracking || 'N/A';

        // Documentation
        document.getElementById('documentation').querySelector('dd').querySelector('span').textContent = 
            formatList(projects.supporting_tools.documentation.others);

        // Communication
        document.getElementById('communication').querySelector('dd').querySelector('span').textContent = 
            formatList(projects.supporting_tools.communication.others);

        // Collaboration
        document.getElementById('collaboration').querySelector('dd').querySelector('span').textContent = 
            formatList(projects.supporting_tools.collaboration.others);

        // Incident Management
        document.getElementById('incident_management').querySelector('dd').querySelector('span').textContent = 
            projects.supporting_tools.incident_management || 'N/A';
    }

    document.addEventListener('DOMContentLoaded', function() {
        loadData();
    });
</script>
{% endblock %}
