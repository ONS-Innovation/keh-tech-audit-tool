{% extends "layout/_template.njk" %}
{% from "components/input/_macro.njk" import onsInput %}
{% from "components/button/_macro.njk" import onsButton %}
{% from "components/radios/_macro.njk" import onsRadios %}
{% from "components/question/_macro.njk" import onsQuestion %}
{% from "components/accordion/_macro.njk" import onsAccordion %}
{% from "components/breadcrumbs/_macro.njk" import onsBreadcrumbs %}


{%
    set pageConfig = {
        "header": {
            "title": "Hub example",
            "signoutButton": {
                "text": "Save and sign out"
            }
        }
    }
%}

{% block main %}

<h1>About You</h1>

{{
    onsAccordion({
        "id": "accordion-example",
        "itemsList": [
            {
                "title": "More info",
                "content": "Enter details about the project owner such as: <ul><li>Contact Email</li> <li>Owner Email</li> <li>Role</li></ul>"
            }
        ]
    })
}}


<form action="{{ url_for('survey') }}" method="GET">

{{
    onsInput({
        "id": "contact-email",
        "label": {
            "text": "Contact Email"
        }
    })
}}

{{
    onsInput({
        "id": "owner-email",
        "label": {
            "text": "Owner Email"
        }
    })
}}

{%
    call onsQuestion({
        "classes": "ons-u-mt-no",
        "legendIsQuestionTitle": true
    })
%}
    {{
        onsRadios({
            "dontWrap": true,
            "name": "role",
            "radios": [
                {
                    "id": "tech-lead",
                    "label": {
                        "text": "Tech Lead"
                    },
                    "value": "Tech Lead"
                },
                {
                    "id": "seo",
                    "label": {
                        "text": "SEO"
                    },
                    "value": "SEO"
                },
                {
                    "id": "heo",
                    "label": {
                        "text": "HEO"
                    },
                    "value": "HEO"
                },
                {
                    "id": "other",
                    "label": {
                        "text": "Other"
                    },
                    "value": "other",
                    "other": {
                        "id": "other-input",
                        "name": "other",
                        "label": {
                            "text": "Enter your role"
                        }
                    }
                }
            ]
        })
    }}
{% endcall %}

<script>
    function storeData() {
        var contactEmail = document.getElementById('contact-email').value;
        var ownerEmail = document.getElementById('owner-email').value;
        var role = document.querySelector('input[name="role"]:checked').value;
        var otherRole = document.getElementById('other-input').value;
        var completeAboutYou = true;

        var data = {
            "contactEmail": contactEmail,
            "ownerEmail": ownerEmail,
            "role": role,
            "completeAboutYou": completeAboutYou
        };

        if (role === 'other') {
            data.role = otherRole;
        }

        localStorage.setItem('you_data', JSON.stringify(data));

        console.log(localStorage.getItem('you_data'));
    }

    function loadData() {
        var obj = {
            "Tech Lead": "tech-lead",
            "SEO": "seo",
            "HEO": "heo"
        }
        var data = JSON.parse(localStorage.getItem('you_data'));

        if (data) {
            document.getElementById('contact-email').value = data.contactEmail;
            document.getElementById('owner-email').value = data.ownerEmail;

            if (data.role != "Tech Lead" && data.role != "SEO" && data.role != "HEO") {
                var option = "other";
                document.getElementById('other-input').value = data.role;
            } else {
                var option = obj[data.role];
            }

            document.getElementById(option).checked = true;
            console.log(option);
        }
    }

    loadData();
</script>

{{
    onsButton({
        "text": "Save and continue",
        "attributes": {
            "onclick": "storeData();"
        }
    })
}}
</form>

{% endblock %}